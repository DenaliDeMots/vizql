<!DOCTYPE html>
<meta charset="utf-8">
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: sans-serif;
    }

    .link {
        fill: none;
        stroke: #bbb;
    }

    table {
        border: 1px solid black;
        background-color: lightblue;
    }
</style>
<svg width="960" height="600"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

    let data = { "schemas": [{ "name": "movies", "columns": [{ "content": "id", "type": "INTEGER" }, { "content": "title", "type": "STRING" }, { "content": "summary", "type": "STRING" }, { "content": "releaseDate", "type": "STRING" }, { "content": "runtime", "type": "STRING" }, { "content": "posterPath", "type": "STRING" }, { "content": "rating", "type": "STRING" }, { "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }] }, { "name": "character", "columns": [{ "content": "id", "type": "INTEGER" }, { "content": "characterName", "type": "STRING" }, { "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }] }, { "name": "moviecharacters", "columns": [{ "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }, { "content": "characterId", "type": "INTEGER", "relation": { "model": "characters", "key": "id" } }, { "content": "movieId", "type": "INTEGER", "relation": { "model": "movies", "key": "id" } }] }, { "name": "roles", "columns": [{ "content": "id", "type": "INTEGER" }, { "content": "roleType", "type": "STRING" }, { "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }] }, { "name": "characterroles", "columns": [{ "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }, { "content": "roleId", "type": "INTEGER", "relation": { "model": "roles", "key": "id" } }, { "content": "characterId", "type": "INTEGER", "relation": { "model": "characters", "key": "id" } }] }, { "name": "genres", "columns": [{ "content": "id", "type": "INTEGER" }, { "content": "genreName", "type": "STRING" }, { "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }] }, { "name": "moviegenres", "columns": [{ "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }, { "content": "movieId", "type": "INTEGER", "relation": { "model": "movies", "key": "id" } }, { "content": "genreId", "type": "INTEGER", "relation": { "model": "genres", "key": "id" } }] }, { "name": "tvseries", "columns": [{ "content": "id", "type": "INTEGER" }, { "content": "title", "type": "STRING" }, { "content": "genre", "type": "STRING" }, { "content": "startYear", "type": "STRING" }, { "content": "endYear", "type": "STRING" }, { "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }] }, { "name": "tvgenres", "columns": [{ "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }, { "content": "tvseryId", "type": "INTEGER", "relation": { "model": "tvseries", "key": "id" } }, { "content": "genreId", "type": "INTEGER", "relation": { "model": "genres", "key": "id" } }] }, { "name": "tvseasons", "columns": [{ "content": "id", "type": "INTEGER" }, { "content": "summary", "type": "STRING" }, { "content": "seasonNumber", "type": "STRING" }, { "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }, { "content": "tvseryId", "type": "INTEGER", "relation": { "model": "tvseries", "key": "id" } }] }, { "name": "tvepisodes", "columns": [{ "content": "id", "type": "INTEGER" }, { "content": "title", "type": "STRING" }, { "content": "summary", "type": "STRING" }, { "content": "airDate", "type": "STRING" }, { "content": "createdAt", "type": "DATE" }, { "content": "updatedAt", "type": "DATE" }, { "content": "tvseasonId", "type": "INTEGER", "relation": { "model": "tvseasons", "key": "id" } }] }], "links": [{ "source": "moviecharacters", "target": "character" }, { "source": "moviecharacters", "target": "movies" }, { "source": "characterroles", "target": "roles" }, { "source": "characterroles", "target": "character" }, { "source": "moviegenres", "target": "movies" }, { "source": "moviegenres", "target": "genres" }, { "source": "tvgenres", "target": "tvseries" }, { "source": "tvgenres", "target": "genres" }, { "source": "tvseasons", "target": "tvseries" }, { "source": "tvepisodes", "target": "tvseasons" }] }
</script>
<script>

    var svg = d3.select("svg"),
        width = window.innerWidth,
        height = window.innerHeight

    svg.attr("width", window.innerWidth)
    svg.attr("height", window.innerHeight);

    var color = d3.scaleOrdinal(d3.schemeCategory20);

    var simulation = d3.forceSimulation()
        .force("link", d3.forceLink().distance(300).strength(2))
        .force("charge", d3.forceManyBody())
        .force("center", d3.forceCenter(width / 2, height / 2));


    // Build the arrow
    svg.append("svg:defs").selectAll("marker")
        .data(["end"])      // Different link/path types can be defined here
        .enter().append("svg:marker")    // This section adds in the arrows
        .attr("id", String)
        .attr("viewBox", "0 -5 10 10")
        .attr("refX", 15)
        .attr("refY", -1.5)
        .attr("markerWidth", 6)
        .attr("markerHeight", 6)
        .attr("orient", "auto")
        .append("svg:path")
        .attr("d", "M0,-5L10,0L0,5");


    var nodes = data.schemas,
        nodeById = d3.map(nodes, d => d.name),
        links = data.links,
        bilinks = [];

    links.forEach(function (link) {
        var s = link.source = nodeById.get(link.source),
            t = link.target = nodeById.get(link.target);
            i = {}; // intermediate node
        nodes.push(i);
        links.push({ source: s, target: t });
        bilinks.push([s, i, t]);
    });

    var link = svg.selectAll(".link")
        .data(bilinks)
        .enter().append("line")
        .attr("class", "link")
        .attr("marker-end", "url(#end)"); //add arrow

    var tableData = nodes.filter(n => n.name)

    var node = svg.selectAll(".node")
        .data(tableData)
        .enter().append("foreignObject")
        .attr("class", "node")
        .attr("width", 50)
        .attr('height', 50)
        .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended));

    var table = node
        .append('xhtml:table')

    //add table name
    table
        .append('xhtml:tr')
        .append('xhtml:th')
        .attr('colspan', 2)
        .text(t => t.name)

    let row = table.selectAll('.child').data(d => d.columns).enter().append('tr')
    row.append('td').text(d => d.content)
    row.append('td').text(d => d.type)

    simulation
        .nodes(nodes)
        .on("tick", ticked);


    simulation.force("link")
        .links(links);

    function ticked() {
        link.attr("d", positionLink);
        node.attr("transform", positionNode);
    }

    function positionLink(d) {
        return "M" + d[0].x + "," + d[0].y
            + "S" + d[1].x + "," + d[1].y
            + " " + d[2].x + "," + d[2].y;
    }

    function positionNode(d) {
        return "translate(" + d.x + "," + d.y + ")";
    }

    function dragstarted(d) {
        if (!d3.event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x, d.fy = d.y;
    }

    function dragged(d) {
        d.fx = d3.event.x, d.fy = d3.event.y;
    }

    function dragended(d) {
        if (!d3.event.active) simulation.alphaTarget(0);
        d.fx = null, d.fy = null;
    }

</script>